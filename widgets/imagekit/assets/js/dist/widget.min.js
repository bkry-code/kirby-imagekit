!function(e,n,t){function i(n){var t=e.ImageKitSettings.translations[n];return void 0!==t?t:"["+n+"]"}function a(e){for(var n=e.concat(),t=0;t<n.length;++t)for(var i=t+1;i<n.length;++i)n[t]===n[i]&&n.splice(i--,1);return n}function r(e){function n(e,n,i,a){a=a||"GET",i=i||{},n=n||function(){};var r=m.api+e;return t.ajax({url:r,dataType:"json",method:a,data:i,success:function(e){n(e)},error:function(e,n,t){m.error(e.responseJSON)}})}function i(e){v=e}function r(){v=!1}function c(e){return void 0===e?v:v===e}function o(e){return n("status",e)}function u(e){return g(),i(k),n(k,function(n){r(k),e(n.data)})}function s(e,t){function a(){n(h,function(n){n.data.pending>0&&!f()?(e(n.data),a()):(r(h),t(n.data))})}g(),i(h),e=e||function(){},t=t||function(){},a()}function l(e,c,o){g(),i(b),e=e||function(){},c=c||function(){},o=o||function(){},n(b,function(n){var i=0,u=n.data,s=function(){t.ajax({url:u[i],headers:{"X-ImageKit-Indexing":1},success:function(n){n.data.links.length>0&&(u=a(u.concat(n.data.links))),++i>=u.length||f()?(r(b),c({total:u.length,status:n.data.status})):(e({current:i,total:u.length,url:u[i],status:n.data.status}),s())},error:function(e){o(e.responseJSON)}})};s()})}function d(){p=!0}function f(){return p}function g(){v=!1,p=!1}var m=t.extend({error:function(e){console.error(e.message)}},e),v=!1,p=!1,h="create",k="clear",b="index";return{status:o,clear:u,create:s,index:l,cancel:d,cancelled:f,running:c,reset:g}}function c(){function e(e){return e===l?d:(u.classList[e?"remove":"add"]("is-hidden"),l=e,f)}function t(){return u.classList.add("is-disabled"),f}function i(){return u.classList.remove("is-disabled"),f}function a(){return e(!0)}function r(){return e(!1)}function c(e){return null!==e&&e!==!1?u.setAttribute("value",e):u.removeAttribute("value"),f}function o(e){return e?(s.innerHTML=e,f):s.innerHTML}var u=n.querySelector(".js-imagekit-progress"),s=n.querySelector(".js-imagekit-progress-text"),l=!1,d=this,f={};return f={show:a,hide:r,value:c,text:o,enable:i,disable:t}}function o(){function e(e){return e?c[e].element.addClass("imagekit-action--disabled"):t.each(c,function(){this.element.addClass("imagekit-action--disabled")}),r}function n(e){return e?c[e].element.removeClass("imagekit-action--disabled"):t.each(c,function(){this.element.removeClass("imagekit-action--disabled")}),r}function i(e,n,t){var i=c[e].icon;return i.removeClass(n),i.addClass(t),r}function a(e,n){return c[e].element.click(function(e){e.preventDefault(),n()}),r}var r={},c={clear:{element:t('[href="#imagekit-action-clear"]'),icon:t('[href="#imagekit-action-clear"] i')},create:{element:t('[href="#imagekit-action-create"]'),icon:t('[href="#imagekit-action-create"] i')}};return r={disable:e,enable:n,icon:i,register:a}}function u(a){function u(e){k.innerHTML=e.created,b.innerHTML=e.pending}function s(e,n){n=n||!1,h.disable(),w.disable();var i=t("<div/>").addClass("imagekit-error-overlay");i.append('<i class="imagekit-error-icon">'),i.append(t("<p/>").html(e)),t("#imagekit-widget").append(i),n&&i.append(t('<a href="#" class="btn btn-rounded">OK</a>').click(function(){i.remove(),p.reset(),w.hide(),h.enable().icon("create","fa-stop-circle-o","fa-play-circle-o"),l(),n()}))}function l(){p.running()||p.status(function(e){u(e.data)})}function d(){p.running()||e.confirm(i("imagekit.widget.clear.confirm"))&&(h.disable(),w.value(!1).text(i("imagekit.widget.progress.clearing")).show(),p.clear(function(e){w.hide(),h.enable(),u(e)}))}function f(e){e=e||function(){},w.text(i("imagekit.widget.progress.scanning")),p.index(function(e){w.value(e.current/e.total).text(i("imagekit.widget.progress.scanning")+" "+e.current+"/"+e.total),u(e.status)},function(n){w.value(1).text(i("imagekit.widget.progress.scanned")),u(n.status),e()},function(e){s(e.message,function(){alert("closed")})})}function g(e){e=e||function(){},w.value(!1).text(i("imagekit.widget.progress.creating")),p.create(function(e){var n=e.pending+e.created;w.value(e.created/n),u(e)},function(n){w.value(1),u(n),e()})}function m(){function e(){w.hide(),h.enable().icon("create","fa-stop-circle-o","fa-play-circle-o")}h.disable("clear").icon("create","fa-play-circle-o","fa-stop-circle-o"),w.value(!1).show(),ImageKitSettings.discover?f(function(){p.cancelled()?e():g(e)}):g(e)}function v(){if(p.running("index")||p.running("create"))return h.disable(),w.value(!1).text(i("imagekit.widget.progress.cancelling")),void p.cancel()}var p=new r(t.extend(ImageKitSettings,{error:function(e){s(e.message)}})),h=new o,k=(n.querySelector(".js-imagekit-info"),n.querySelector(".js-imagekit-created")),b=n.querySelector(".js-imagekit-pending"),w=new c;return h.register("clear",d),h.register("create",function(){p.running()?v():m()}),{status:l}}t(function(){var e=new u;e.status()})}(window,document,jQuery);