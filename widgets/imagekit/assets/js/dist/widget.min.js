!function(e,n,t){function i(n){var t=e.ImageKitSettings.translations[n];return void 0!==t?t:"["+n+"]"}function a(e){for(var n=e.concat(),t=0;t<n.length;++t)for(var i=t+1;i<n.length;++i)n[t]===n[i]&&n.splice(i--,1);return n}function r(e){function n(e,n,i,a){a=a||"GET",i=i||{},n=n||function(){};var r=m.api+e;return t.ajax({url:r,dataType:"json",method:a,data:i,success:function(e){n(e)},error:function(e,n,t){m.error(e.responseJSON)}})}function i(e){v=e}function r(){v=!1}function c(e){return void 0===e?v:v===e}function o(e){return n("status",e)}function u(e){return g(),i(h),n(h,function(n){r(h),e(n.data)})}function s(e,t){function a(){n(k,function(n){n.data.pending>0&&!f()?(e(n.data),a()):(r(k),t(n.data))})}g(),i(k),e=e||function(){},t=t||function(){},a()}function l(e,c){g(),i(b),e=e||function(){},c=c||function(){},n(b,function(n){var i=0,o=n.data,u=function(){t.ajax({url:o[i],headers:{"X-ImageKit-Indexing":1},success:function(n){n.data.links.length>0&&(o=a(o.concat(n.data.links))),++i>=o.length||f()?(r(b),c({total:o.length,status:n.data.status})):(e({current:i,total:o.length,url:o[i],status:n.data.status}),u())}})};u()})}function d(){p=!0}function f(){return p}function g(){v=!1,p=!1}var m=t.extend({error:function(e){console.error(e.message)}},e),v=!1,p=!1,k="create",h="clear",b="index";return{status:o,clear:u,create:s,index:l,cancel:d,cancelled:f,running:c}}function c(){function e(e){return e===l?d:(u.classList[e?"remove":"add"]("is-hidden"),l=e,f)}function t(){return u.classList.add("is-disabled"),f}function i(){return u.classList.remove("is-disabled"),f}function a(){return e(!0)}function r(){return e(!1)}function c(e){return null!==e&&e!==!1?u.setAttribute("value",e):u.removeAttribute("value"),f}function o(e){return e?(s.innerHTML=e,f):s.innerHTML}var u=n.querySelector(".js-imagekit-progress"),s=n.querySelector(".js-imagekit-progress-text"),l=!1,d=this,f={};return f={show:a,hide:r,value:c,text:o,enable:i,disable:t}}function o(){function e(e){return e?c[e].element.addClass("imagekit-action--disabled"):t.each(c,function(){this.element.addClass("imagekit-action--disabled")}),r}function n(e){return e?c[e].element.removeClass("imagekit-action--disabled"):t.each(c,function(){this.element.removeClass("imagekit-action--disabled")}),r}function i(e,n,t){var i=c[e].icon;return i.removeClass(n),i.addClass(t),r}function a(e,n){return c[e].element.click(function(e){e.preventDefault(),n()}),r}var r={},c={clear:{element:t('[href="#imagekit-action-clear"]'),icon:t('[href="#imagekit-action-clear"] i')},create:{element:t('[href="#imagekit-action-create"]'),icon:t('[href="#imagekit-action-create"] i')}};return r={disable:e,enable:n,icon:i,register:a}}function u(a){function u(e){h.innerHTML=e.created,b.innerHTML=e.pending}function s(e){k.disable(),w.disable();var n=t("<div/>").addClass("imagekit-error-overlay");n.append('<i class="imagekit-error-icon">'),n.append(t("<div/>").html(e)),t("#imagekit-widget").append(n)}function l(){p.running()||p.status(function(e){u(e.data)})}function d(){p.running()||e.confirm(i("imagekit.widget.clear.confirm"))&&(k.disable(),w.value(!1).text(i("imagekit.widget.progress.clearing")).show(),p.clear(function(e){w.hide(),k.enable(),u(e)}))}function f(e){e=e||function(){},w.text(i("imagekit.widget.progress.scanning")),p.index(function(e){w.value(e.current/e.total).text(i("imagekit.widget.progress.scanning")+" "+e.current+"/"+e.total),u(e.status)},function(n){w.value(1).text(i("imagekit.widget.progress.scanned")),u(n.status),e()})}function g(e){e=e||function(){},w.value(!1).text(i("imagekit.widget.progress.creating")),p.create(function(e){var n=e.pending+e.created;w.value(e.created/n),u(e)},function(n){w.value(1),u(n),e()})}function m(){function e(){w.hide(),k.enable().icon("create","fa-stop-circle-o","fa-play-circle-o")}k.disable("clear").icon("create","fa-play-circle-o","fa-stop-circle-o"),w.value(!1).show(),ImageKitSettings.discover?f(function(){p.cancelled()?e():g(e)}):g(e)}function v(){if(p.running("index")||p.running("create"))return k.disable(),w.value(!1).text(i("imagekit.widget.progress.cancelling")),void p.cancel()}var p=new r(t.extend(ImageKitSettings,{error:function(e){s(e.message)}})),k=new o,h=(n.querySelector(".js-imagekit-info"),n.querySelector(".js-imagekit-created")),b=n.querySelector(".js-imagekit-pending"),w=new c;return k.register("clear",d),k.register("create",function(){p.running()?v():m()}),{status:l}}t(function(){var e=new u;e.status()})}(window,document,jQuery);